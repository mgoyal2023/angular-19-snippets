import{I as g,L as i,Ob as r,ca as o,fa as l}from"./chunk-QHDRAHZY.js";var h=class s{constructor(e){this.platformId=e;r(this.platformId)&&window.addEventListener("storage",t=>{if(t.storageArea===this._getStorage()){let a={key:t.key||"",newValue:t.newValue?JSON.parse(t.newValue):null,oldValue:t.oldValue?JSON.parse(t.oldValue):null,storageType:this._storageType(),action:t.key===null?"clear":t.newValue===null?"remove":"set"};this._notifyChange(a)}})}_storageType=o("session");currentStorageType=this._storageType.asReadonly();_latestChange=o(null);latestChange=this._latestChange.asReadonly();keyChanges=new Map;_getStorage(){return r(this.platformId)?this._storageType()==="local"?localStorage:sessionStorage:{}}_notifyChange(e){this._latestChange.set(e),this.keyChanges.has(e.key)&&this.keyChanges.get(e.key)?.set(e),e.action==="clear"&&this.keyChanges.forEach(t=>{t.set(e)})}setStorageType(e){this._storageType.set(e)}set(e,t){if(r(this.platformId))try{let a=this._getStorage(),n=this.get(e);a.setItem(e,JSON.stringify(t));let c={key:e,newValue:t,oldValue:n,storageType:this._storageType(),action:"set"};this._notifyChange(c)}catch(a){console.error("Error storing data",a)}}get(e){if(!r(this.platformId))return null;try{let a=this._getStorage().getItem(e);return a?JSON.parse(a):null}catch(t){return console.error("Error retrieving data",t),null}}remove(e){let t=this._getStorage(),a=this.get(e);t.removeItem(e);let n={key:e,newValue:null,oldValue:a,storageType:this._storageType(),action:"remove"};this._notifyChange(n)}clear(){this._getStorage().clear();let t={key:"",newValue:null,oldValue:null,storageType:this._storageType(),action:"clear"};this._notifyChange(t)}has(e){return this._getStorage().getItem(e)!==null}watch(e){return this.keyChanges.has(e)||this.keyChanges.set(e,o(null)),this.keyChanges.get(e).asReadonly()}static \u0275fac=function(t){return new(t||s)(i(l))};static \u0275prov=g({token:s,factory:s.\u0275fac,providedIn:"root"})};export{h as a};
